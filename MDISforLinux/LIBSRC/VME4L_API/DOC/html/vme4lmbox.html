<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>MEN - VME4L API - Mailbox support</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="Language" content="en, english">
<meta name="Copyright" content="All material copyright MEN Mikro Elektronik GmbH">
<link href="men_stylesheet.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="left_to_right" style="padding-top: 6px; background-color: #F0F0F0; height: 110px; border-bottom: 2px solid #D1D1D2;">
	<!-- Titel -->
	<img src="menlogo.gif" alt="MEN" style="float: left; height: 103px; width: 155px; margin: 0px;">
	<h1 style="margin: 0px; padding-top: 35px; padding-bottom: 0px;">VME4L API &nbsp; </h1>
	<h3>Mailbox support</h3>
</div>

<div class="left_to_right">
<!-- Hauptteil -->
	<div class="main">
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1><a name="vme4lmbox">Mailbox support</a>
</h1>VME4L supports up to 8 mailboxes. A mailbox is a register that can be read or written both from VME and from the local CPU.<p>
Upon read/write accesses from VME, an interrupt can be generated and VME4L can send a signal to the application process. The value of the mailbox can then be read or written by application.<p>
<div class="fragment"><pre>  <span class="comment">// Error checking omitted in this example</span>
<span class="preprocessor">  #include &lt;stdio.h&gt;</span>
<span class="preprocessor">  #include &lt;stdlib.h&gt;</span>
<span class="preprocessor">  #include &lt;string.h&gt;</span>
<span class="preprocessor">  #include &lt;stdint.h&gt;</span>
<span class="preprocessor">  #include &lt;signal.h&gt;</span>
<span class="preprocessor">  #include &lt;errno.h&gt;</span>
<span class="preprocessor">  #include &lt;unistd.h&gt;</span>
<span class="preprocessor">  #include &lt;<a class="code" href="vme4l_8h.html">MEN/vme4l.h</a>&gt;</span>
<span class="preprocessor">  #include &lt;<a class="code" href="vme4l__api_8h.html">MEN/vme4l_api.h</a>&gt;</span>

  <span class="keywordtype">int</span> G_fd;
  <span class="keyword">volatile</span> uint8_t *G_map;
  uint32_t G_mboxValue;

  <span class="keyword">static</span> <span class="keywordtype">void</span> IrqSigHandler( <span class="keywordtype">int</span> sigNum )
  {
       <span class="keywordflow">if</span>( sigNum == 33 )
           <a class="code" href="vme4l__api_8c.html#a34">VME4L_MboxRead</a>( G_fd, 2, &amp;G_mboxValue );
  }

  <span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[] )
  {
      G_fd = <a class="code" href="vme4l__api_8c.html#a2">VME4L_Open</a>( VME4L_SPC_A24_D16 ); <span class="comment">// space number don't care</span>

      signal( 33, IrqSigHandler );

      <span class="comment">// Instruct VME4L to send signal 33</span>
      <span class="comment">// when 3rd mailbox is written from VME</span>
      <a class="code" href="vme4l__api_8c.html#a15">VME4L_SigInstall</a>( G_fd, <a class="code" href="group__VME4L__IRQVEC.html#a5">VME4L_IRQVEC_MBOXWR</a>(2),
                              <a class="code" href="group__VME4L__IRQLEV.html#a13">VME4L_IRQLEV_MBOXWR</a>(2), 33, VME4L_IRQ_ENBL );

      <span class="comment">// Let signals come in</span>
      <span class="keywordflow">while</span>(1)
          sleep(10);

  } 
</pre></div><p>
<dl compact><dt><b>Warning:</b></dt><dd>Any handshaking between the sending CPU and the receiving CPU must be done at application level. The mailbox routines may loose data when the sending CPU writes faster to the mailbox than the receiving CPU is handling the interrupt and the corresponding signal.</dd></dl>
<dl compact><dt><b>Notes for VME-bridge on A13/A15:</b></dt><dd>The VME bridge has 4 mailboxes, each 32 bit wide.</dd></dl>
<dl compact><dt><b>Notes for VME-bridge on A12/B11:</b></dt><dd>Mailboxes are not supported</dd></dl>
<dl compact><dt><b>Notes for VME-bridge on A17/A19/A20:</b></dt><dd>The VME bridge has 4 mailboxes. Interrupt is only generated if least significant byte of a mailbox register is written. </dd></dl>

	</div>
</div>

<div class="footer">
<!-- Footer -->
	<p class="footer">
	Generated for VME4L API using <a href="http://www.doxygen.org">doxygen</a>.<br>
	Copyright &copy; 2019 <a href="http://www.men.de">MEN Mikro Elektronik GmbH</a>. All Rights Reserved.
	</p>
</div>

</body>
</html>

