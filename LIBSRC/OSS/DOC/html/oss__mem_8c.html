<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>MEN - OSS module for Linux/RTAI - oss_mem.c File Reference</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="Language" content="en, english">
<meta name="Copyright" content="All material copyright MEN Mikro Elektronik GmbH">
<link href="men_stylesheet.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="left_to_right" style="padding-top: 6px; background-color: #F0F0F0; height: 110px; border-bottom: 2px solid #D1D1D2;">
	<!-- Titel -->
	<img src="menlogo.gif" alt="MEN" style="float: left; height: 103px; width: 155px; margin: 0px;"></a>
	<h1 style="margin: 0px; padding-top: 35px; padding-bottom: 0px;">OSS module for Linux/RTAI &nbsp; 2.15</h1>
	<h3>oss_mem.c File Reference</h3>
</div>

<div class="left_to_right">
<!-- Hauptteil -->
	<div class="main">
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>oss_mem.c File Reference</h1>Memory handling functions of the OSS module.  
<a href="#_details">More...</a>
<p>
<table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="oss__mem_8c.html#a4">OSS_RtaiMemGet</a> (OSS_HANDLE *, u_int32, u_int32 *)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocates general memory block. </em> <a href="#a4"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int32&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="oss__mem_8c.html#a5">OSS_RtaiMemFree</a> (OSS_HANDLE *, void *, u_int32)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return memory block. </em> <a href="#a5"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="oss__mem_8c.html#a6">OSS_MemGet</a> (OSS_HANDLE *oss, u_int32 size, u_int32 *gotsizeP)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocates general memory block. </em> <a href="#a6"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int32&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="oss__mem_8c.html#a7">OSS_MemFree</a> (OSS_HANDLE *oss, void *addr, u_int32 size)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return memory block. </em> <a href="#a7"></a><em><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int32&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="oss__mem_8c.html#a8">OSS_MemChk</a> (OSS_HANDLE *oss, void *addr, u_int32 size, int32 mode)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if memory block accessible by caller. </em> <a href="#a8"></a><em><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Memory handling functions of the OSS module. 
<p>
<dl compact><dt><b>Author:</b></dt><dd><a href="mailto:klaus.popp@men.de">klaus.popp@men.de</a> <dl compact><dt><b>Date</b></dt><dd>2005/07/07 17:17:24 </dd></dl>
<dl compact><dt><b>Revision</b></dt><dd>1.4 </dd></dl>
</dd></dl>
<dl compact><dt><b>Project:</b></dt><dd>MDIS4Linux </dd></dl>
<dl compact><dt><b>Preprocessor Switches:</b></dt><dd>MDIS_RTAI_SUPPORT</dd></dl>
<hr><h2>Function Documentation</h2>
<a name="a8" doxytag="oss_mem.c::OSS_MemChk"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int32 OSS_MemChk </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OSS_HANDLE *&nbsp;</td>
          <td class="mdname" nowrap> <em>oss</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>addr</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>u_int32&nbsp;</td>
          <td class="mdname" nowrap> <em>size</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int32&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Check if memory block accessible by caller. 
<p>
This function checks if the memory block starting at <em>addr</em> can be accessed by calling routine/process with the attributes specified with <em>mode</em>.<p>
This function is typically used to verify that an address in user land is really owned by the calling process to avoid that the kernel mode driver crashes the system due to incorrectly passed addresses.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>oss</em>&nbsp;</td><td><b>IN</b> OSS handle, returned by <a class="el" href="oss_8c.html#a66">OSS_Init()</a> </td></tr>
    <tr><td valign=top><em>addr</em>&nbsp;</td><td><b>IN</b> address of memory block to check </td></tr>
    <tr><td valign=top><em>size</em>&nbsp;</td><td><b>IN</b> number of bytes to check starting at <em>addr</em> </td></tr>
    <tr><td valign=top><em>mode</em>&nbsp;</td><td><b>IN</b> combination of <code>OSS_READ</code> ORed with <code>OSS_WRITE</code> </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 on success or <code>ERR_OSS_NO_PERM</code> if no permission</dd></dl>
<p>
<dl compact><dt><b>Linux notes:</b></dt><dd>This function is a no-op. When used in MDIS context, all user buffers are copied first from user space and are therefore always valid kernel addresses. </dd></dl>
    </td>
  </tr>
</table>
<a name="a7" doxytag="oss_mem.c::OSS_MemFree"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int32 OSS_MemFree </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OSS_HANDLE *&nbsp;</td>
          <td class="mdname" nowrap> <em>oss</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>addr</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>u_int32&nbsp;</td>
          <td class="mdname" nowrap> <em>size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Return memory block. 
<p>
Returns a memory block previously allocated by <a class="el" href="oss__mem_8c.html#a6">OSS_MemGet()</a>.<p>
<dl compact><dt><b>Remarks:</b></dt><dd>The result is undefined if an attempt is made to free a block not previously allocated or with a different size.<p>
<a class="el" href="oss__mem_8c.html#a7">OSS_MemFree()</a> should not be used in IRQ or Alarm routines.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>oss</em>&nbsp;</td><td><b>IN</b> OSS handle, returned by <a class="el" href="oss_8c.html#a66">OSS_Init()</a> </td></tr>
    <tr><td valign=top><em>addr</em>&nbsp;</td><td><b>IN</b> address of memory block </td></tr>
    <tr><td valign=top><em>size</em>&nbsp;</td><td><b>IN</b> number of bytes to free </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 on success or <code>ERR_OSS_xxx</code> error code on error</dd></dl>
<p>
<dl compact><dt><b>Linux notes:</b></dt><dd>The behaviour of this function depends on the <em>rtMode</em> flag passed to the <a class="el" href="oss_8c.html#a66">OSS_Init()</a> function. Either the standard Linux kernel or RTAI implementation is called. See <a class="el" href="oss__mem_8c.html#a5">OSS_RtaiMemFree()</a> </dd></dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="oss__mem_8c.html#a6">OSS_MemGet</a> </dd></dl>
    </td>
  </tr>
</table>
<a name="a6" doxytag="oss_mem.c::OSS_MemGet"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void * OSS_MemGet </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OSS_HANDLE *&nbsp;</td>
          <td class="mdname" nowrap> <em>oss</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>u_int32&nbsp;</td>
          <td class="mdname" nowrap> <em>size</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>u_int32 *&nbsp;</td>
          <td class="mdname" nowrap> <em>gotsizeP</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Allocates general memory block. 
<p>
<a class="el" href="oss__mem_8c.html#a6">OSS_MemGet()</a> will allocate a memory block with at least the requested <em>size</em>. Depending on the operating system the actual block may be larger; this size is returned in <em>gotsizeP</em>. When the block is returned to free system memory you must return the actual size, not the requested size. The return value of <a class="el" href="oss__mem_8c.html#a6">OSS_MemGet()</a> is a pointer to the first byte of the memory block or <code>NULL</code> if failed.<p>
The memory block allocated has no special attributes, especially it is not guaranteed to be physically contignous (if the system uses virtual addresses) and it is also not safe to use it for DMA. However each OSS implementation guarantees that the allocated memory block is 4 byte aligned.<p>
Typical usage of the routines:<p>
<div class="fragment"><pre>   <span class="keywordtype">void</span> *block;
  u_int32 gotsize;

  <span class="comment">// Allocate 256 bytes of memory</span>
  block = <a class="code" href="oss__mem_8c.html#a6">OSS_MemGet</a>( llHdl-&gt;osHdl, 256, &amp;gotsize );

  <span class="keywordflow">if</span>( block == NULL ) 
      <span class="keywordflow">return</span> ERR_OSS_MEM_ALLOC;
  <span class="comment">// Here the memory can be used</span>
   ....
  <span class="comment">// free the memory</span>
  <a class="code" href="oss__mem_8c.html#a7">OSS_MemFree</a>( llHdl-&gt;osHdl, block, gotsize );
</pre></div><p>
<dl compact><dt><b>Remarks:</b></dt><dd><a class="el" href="oss__mem_8c.html#a6">OSS_MemGet()</a> should not be used in IRQ or Alarm routines.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>oss</em>&nbsp;</td><td><b>IN</b> OSS handle, returned by <a class="el" href="oss_8c.html#a66">OSS_Init()</a> </td></tr>
    <tr><td valign=top><em>size</em>&nbsp;</td><td><b>IN</b> number of bytes to allocate </td></tr>
    <tr><td valign=top><em>gotsizeP</em>&nbsp;</td><td><b>OUT</b> actual number of bytes allocated </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>pointer to memory block or <code>NULL</code> if memory could not be allocated</dd></dl>
<p>
<dl compact><dt><b>Linux notes:</b></dt><dd>Puts calling process to sleep if no free pages available (i.e. should never return NULL).</dd></dl>
The behaviour of this function depends on the <em>rtMode</em> flag passed to the <a class="el" href="oss_8c.html#a66">OSS_Init()</a> function. Either the standard Linux kernel or RTAI implementation is called. See <a class="el" href="oss__mem_8c.html#a4">OSS_RtaiMemGet()</a><p>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="oss__mem_8c.html#a7">OSS_MemFree</a> </dd></dl>
    </td>
  </tr>
</table>
<a name="a5" doxytag="oss_mem.c::OSS_RtaiMemFree"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int32 OSS_RtaiMemFree </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OSS_HANDLE *&nbsp;</td>
          <td class="mdname" nowrap> <em>oss</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>addr</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>u_int32&nbsp;</td>
          <td class="mdname" nowrap> <em>size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Return memory block. 
<p>
Returns a memory block previously allocated by <a class="el" href="oss__mem_8c.html#a6">OSS_MemGet()</a>.<p>
<dl compact><dt><b>Remarks:</b></dt><dd>The result is undefined if an attempt is made to free a block not previously allocated or with a different size.<p>
<a class="el" href="oss__mem_8c.html#a7">OSS_MemFree()</a> should not be used in IRQ or Alarm routines.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>oss</em>&nbsp;</td><td><b>IN</b> OSS handle, returned by <a class="el" href="oss_8c.html#a66">OSS_Init()</a> </td></tr>
    <tr><td valign=top><em>addr</em>&nbsp;</td><td><b>IN</b> address of memory block </td></tr>
    <tr><td valign=top><em>size</em>&nbsp;</td><td><b>IN</b> number of bytes to free </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 on success or <code>ERR_OSS_xxx</code> error code on error</dd></dl>
 <dl compact><dt><b>See also:</b></dt><dd><a class="el" href="oss__mem_8c.html#a4">OSS_RtaiMemGet</a> </dd></dl>
    </td>
  </tr>
</table>
<a name="a4" doxytag="oss_mem.c::OSS_RtaiMemGet"></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void* OSS_RtaiMemGet </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OSS_HANDLE *&nbsp;</td>
          <td class="mdname" nowrap> <em>oss</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>u_int32&nbsp;</td>
          <td class="mdname" nowrap> <em>size</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>u_int32 *&nbsp;</td>
          <td class="mdname" nowrap> <em>gotsizeP</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Allocates general memory block. 
<p>
<a class="el" href="oss__mem_8c.html#a6">OSS_MemGet()</a> will allocate a memory block with at least the requested <em>size</em>. Depending on the operating system the actual block may be larger; this size is returned in <em>gotsizeP</em>. When the block is returned to free system memory you must return the actual size, not the requested size. The return value of <a class="el" href="oss__mem_8c.html#a6">OSS_MemGet()</a> is a pointer to the first byte of the memory block or <code>NULL</code> if failed.<p>
The memory block allocated has no special attributes, especially it is not guaranteed to be physically contignous (if the system uses virtual addresses) and it is also not safe to use it for DMA. However each OSS implementation guarantees that the allocated memory block is 4 byte aligned.<p>
Typical usage of the routines:<p>
<div class="fragment"><pre>   <span class="keywordtype">void</span> *block;
  u_int32 gotsize;

  <span class="comment">// Allocate 256 bytes of memory</span>
  block = <a class="code" href="oss__mem_8c.html#a6">OSS_MemGet</a>( llHdl-&gt;osHdl, 256, &amp;gotsize );

  <span class="keywordflow">if</span>( block == NULL ) 
      <span class="keywordflow">return</span> ERR_OSS_MEM_ALLOC;
  <span class="comment">// Here the memory can be used</span>
   ....
  <span class="comment">// free the memory</span>
  <a class="code" href="oss__mem_8c.html#a7">OSS_MemFree</a>( llHdl-&gt;osHdl, block, gotsize );
</pre></div><p>
<dl compact><dt><b>Remarks:</b></dt><dd><a class="el" href="oss__mem_8c.html#a6">OSS_MemGet()</a> should not be used in IRQ or Alarm routines.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>oss</em>&nbsp;</td><td><b>IN</b> OSS handle, returned by <a class="el" href="oss_8c.html#a66">OSS_Init()</a> </td></tr>
    <tr><td valign=top><em>size</em>&nbsp;</td><td><b>IN</b> number of bytes to allocate </td></tr>
    <tr><td valign=top><em>gotsizeP</em>&nbsp;</td><td><b>OUT</b> actual number of bytes allocated </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>pointer to memory block or <code>NULL</code> if memory could not be allocated</dd></dl>
<p>
<dl compact><dt><b>RTAI notes:</b></dt><dd>Uses rt_malloc. Therefore the maximum size one can allocate depends on the configuration of <code>rt_mem_mgr</code>.</dd></dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="oss__mem_8c.html#a5">OSS_RtaiMemFree</a> </dd></dl>
    </td>
  </tr>
</table>

	</div>
</div>

<div class="footer">
<!-- Footer -->
	<p class="footer">
	Generated for OSS module for Linux/RTAI using <a href="http://www.doxygen.org">doxygen</a>.<br>
	Copyright &copy; 2012 <a href="http://www.men.de">MEN Mikro Elektronik GmbH</a>. All Rights Reserved.
	</p>
</div>

</body>
</html>

