<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>MEN - Z100 FPGA update tool - Tool Usage</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="Language" content="en, english">
<meta name="Copyright" content="All material copyright MEN Mikro Elektronik GmbH">
<link href="men_stylesheet.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="left_to_right" style="padding-top: 6px; background-color: #F0F0F0; height: 110px; border-bottom: 2px solid #D1D1D2;">
	<!-- Titel -->
	<img src="menlogo.gif" alt="MEN" style="float: left; height: 103px; width: 155px; margin: 0px;"></a>
	<h1 style="margin: 0px; padding-top: 35px; padding-bottom: 0px;">Z100 FPGA update tool &nbsp; </h1>
	<h3>Tool Usage</h3>
</div>

<div class="left_to_right">
<!-- Hauptteil -->
	<div class="main">
<!-- Generated by Doxygen 1.3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1><a name="pageUsage">Tool Usage</a>
</h1>By default the tool will access the flash using the MEN 16Z045_FLASH FPGA module which directly accesses the flash device.<p>
On some boards (e.g. A404, A500) the flash is accessed via another flash interface in a PLD. This PLD is usually addressed using an SMBus interface.<p>
<br>
 <h2><a name="sectusage"></a>
Access modes and examples</h2>
Here are some explanations and examples for the different access modes. For exact syntax and definition of the single parameters please see the help function of the software: <div class="fragment"><pre>
	fpga_load -h
	</pre></div><h3><a name="pciZ045"></a>
Access over PCI bus and 16Z045_FLASH or 16Z126_SPI_FLASH</h3>
here you can normally use the Chameleon Table in the FPGA to find the correct address of the FLASH interface:<ul>
<li>identify the desired PCI device: <div class="fragment"><pre>
	    &gt; fpga_load -s
	    &gt; fpga_load &lt;ven ID&gt; &lt;dev ID&gt; &lt;subVen ID&gt; -s
	    </pre></div></li><li>check that you access the correct device, read the header from FLASH <div class="fragment"><pre>
	    &gt; fpga_load &lt;ven ID&gt; &lt;dev ID&gt; &lt;subVen ID&gt; &lt;idx&gt; -r &lt;offs in flash&gt; &lt;len&gt;
	    </pre></div></li><li>show the Chameleon Table within the FPGA <div class="fragment"><pre>
	    &gt; fpga_load &lt;ven ID&gt; &lt;dev ID&gt; &lt;subVen ID&gt; &lt;idx&gt; -t
	    </pre></div></li><li>use the 16Z126_SPI_FLASH interface, read the header from FLASH <div class="fragment"><pre>
	    &gt; fpga_load &lt;ven ID&gt; &lt;dev ID&gt; &lt;subVen ID&gt; &lt;idx&gt; -z -r &lt;offs in flash&gt; &lt;len&gt;
	    </pre></div></li><li>load/update the FPGA <div class="fragment"><pre>
	    &gt; fpga_load &lt;ven ID&gt; &lt;dev ID&gt; &lt;subVen ID&gt; &lt;idx&gt; -u &lt;FPGA update file&gt; &lt;offset in flash&gt;
	    </pre></div>e.g. <div class="fragment"><pre>
	  &gt; fpga_load -s
	  &gt; fpga_load 0x1172 0x4d45 0x7 0 -r 0x0 0x100
	  &gt; fpga_load 0x1172 0x4d45 0x7 0 -t
	  &gt; fpga_load 0x1172 0x4d45 0x7 0 -z -r 0x0 0x100
	  &gt; fpga_load 0x1172 0x4d45 0x7 0 -u P018-00IC001D4.rbf 0x0
	  </pre></div></li></ul>
<h3><a name="vmeZ045"></a>
Access over VME bus and 16Z045_FLASH or 16Z126_SPI_FLASH</h3>
there is no support for Chameleon tables in the FPGA on VME bus. the correct address of the FLASH interface has to be identified manually. The A24/D16 address window will be used. Please only specify the offset in the VME access window.<ul>
<li>check that you access the correct address, read the header from FLASH <div class="fragment"><pre>
	    &gt; fpga_load -a &lt;reg offs in VME window&gt; -r &lt;offs in flash&gt; &lt;len&gt;
	    </pre></div></li><li>check that you access the correct address with the SPI Flash, read the header from FLASH <div class="fragment"><pre>
	    &gt; fpga_load -a &lt;reg offs in VME window&gt; -z -r &lt;offs in flash&gt; &lt;len&gt;
	    </pre></div></li><li>load/update the FPGA (verify header) <div class="fragment"><pre>
	    &gt; fpga_load -a &lt;reg offs in VME window&gt; -u &lt;FPGA update file&gt; &lt;offset in flash&gt;
	    </pre></div></li><li>load/update the FPGA (ignore header) <div class="fragment"><pre>
	    &gt; fpga_load -a &lt;reg offs in VME window&gt; -f -w &lt;FPGA update file&gt; &lt;offset in flash&gt;
	    </pre></div>e.g. <div class="fragment"><pre>
	  &gt; fpga_load -a 0xe003a0 -r 0x0 0x100
	  &gt; fpga_load -a 0xe003a0 -z -r 0x0 0x100
	  &gt; fpga_load -a 0xe003a0 -u A203N00IC041A1.rbf 0x0
	  &gt; fpga_load -a 0xe003a0 -f -w A203N00IC041A1.rbf 0x0
	  </pre></div></li></ul>
<h3><a name="vmeSmbPld"></a>
Access over VME bus and SMB/PLD, using direct HW access</h3>
there is no support for Chameleon tables in the FPGA on VME bus. the corresponding SMBus controller and the offset of the controlers registers have to be identified manually. The A24/D16 address window will be used. Please only specify the offset in the VME access window.<ul>
<li>check that you access the correct address, read the header from FLASH <div class="fragment"><pre>
	    &gt; fpga_load -a &lt;reg offs in VME window&gt; -p &lt;smb controller&gt; -r &lt;offs in flash&gt; &lt;len&gt;
	    </pre></div></li><li>load/update the FPGA (verify header) <div class="fragment"><pre>
	    &gt; fpga_load -a &lt;reg offs in VME window&gt; -p &lt;smb controller&gt; -u &lt;FPGA update file&gt; &lt;offset in flash&gt;
	    </pre></div></li><li>load/update the FPGA (ignore header) <div class="fragment"><pre>
	    &gt; fpga_load -a &lt;reg offs in VME window&gt; -p &lt;smb controller&gt; -f -w &lt;FPGA update file&gt; &lt;offset in flash&gt;
	    </pre></div></li><li>chek that you access the correct address for direct addressing for e.g. M-Modules <div class="fragment"><pre>
	    &gt; fpga_load -d &lt;reg offs&gt; -r &lt;offs in flash&gt; &lt;len&gt; [&lt;file&gt;]
	  	</pre></div>e.g. <div class="fragment"><pre>
	  &gt; fpga_load -a 0xfd8000 -p "menz001" -r 0x0 0x100
	  &gt; fpga_load -a 0xfd8000 -p "menz001" -u A404-00IC090A1.rbf 0x0
	  &gt; fpga_load -a 0xfd8000 -p "menz001" -f -w A404-00IC090A1.rbf 0x0
	  &gt; fpga_load -d 0x88e000f0 -r 0x0 0x800000 file.bin
	  </pre></div></li></ul>
<h3><a name="SmbNumPld"></a>
Access over SMB/PLD, using installed SMBus controllers</h3>
the corresponding SMBus controller has to be identified manually.<ul>
<li>check that you access the correct SMB device, read the header from FLASH <div class="fragment"><pre>
	    &gt; fpga_load -p &lt;smb controller number&gt; -r &lt;offs in flash&gt; &lt;len&gt;
	    </pre></div></li><li>load/update the FPGA (verify header) <div class="fragment"><pre>
	    &gt; fpga_load -p &lt;smb controller number&gt; -u &lt;FPGA update file&gt; &lt;offset in flash&gt;
	    </pre></div></li><li>load/update the FPGA (ignore header) <div class="fragment"><pre>
	    &gt; fpga_load -p &lt;smb controller number&gt; -f -w &lt;FPGA update file&gt; &lt;offset in flash&gt;
	    </pre></div>e.g. <div class="fragment"><pre>
	  &gt; fpga_load -p 0 -r 0x0 0x100
	  &gt; fpga_load -p 0 -u A404-00IC090A1.rbf 0x0
	  &gt; fpga_load -p 0 -f -w A404-00IC090A1.rbf 0x0
	  </pre></div></li></ul>
<h3><a name="SmbA500BusSw"></a>
Set bus switches on A500 ESM carrier board</h3>
the corresponding SMBus controller has to be identified manually. Since the ESM onboard SMB controller is used, the access is normally performed using a preinstalled SMBus controller.<ul>
<li>check that you access the correct SMBus/device, read the header/start of FPGA file from FLASH. The FPGA data in A500-R02 boards Flash memory starts at 0x100 (sometimes 0x200?). Here the FPGA data will start with a pattern similiar to the following: <div class="fragment"><pre>
	    hexdump:
	    FF FF 62 77 3F 00 FF FF  FF FF FF FF FF FF FF FF
	    </pre></div>This can also be used to check the correct version of the tool (swap/nonswap)! <div class="fragment"><pre>
	    &gt; fpga_load -p &lt;smb controller number&gt; -r 0x00 0x300
	    </pre></div></li><li>set bus switches <div class="fragment"><pre>
	    &gt; fpga_load -p &lt;smb controller number&gt; -x &lt;1/2/3&gt;
	    </pre></div>e.g. <div class="fragment"><pre>
	  &gt; fpga_load -p 1 -x 1
	  </pre></div></li></ul>

	</div>
</div>

<div class="footer">
<!-- Footer -->
	<p class="footer">
	Generated for Z100 FPGA update tool using <a href="http://www.doxygen.org">doxygen</a>.<br>
	Copyright &copy; 2010 <a href="http://www.men.de">MEN Mikro Elektronik GmbH</a>. All Rights Reserved.
	</p>
</div>

</body>
</html>

